<!DOCTYPE HTML>
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/splash/splash-icon.png">
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen.png" 			media="screen and (max-device-width: 320px)" />  
    <link rel="apple-touch-startup-image" href="images/splash/splash-screen_402x.png" 		media="(max-device-width: 480px) and (-webkit-min-device-pixel-ratio: 2)" /> 
    <link rel="apple-touch-startup-image" sizes="640x1096" href="images/splash/splash-screen_403x.png" />
    <link rel="apple-touch-startup-image" sizes="1024x748" href="images/splash/splash-screen-ipad-landscape" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : landscape)" />
    <link rel="apple-touch-startup-image" sizes="768x1004" href="images/splash/splash-screen-ipad-portrait.png" media="screen and (min-device-width : 481px) and (max-device-width : 1024px) and (orientation : portrait)" />
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="images/splash/splash-screen-ipad-portrait-retina.png"   media="(device-width: 768px)	and (orientation: portrait)	and (-webkit-device-pixel-ratio: 2)"/>
    <link rel="apple-touch-startup-image" sizes="1496x2048" href="images/splash/splash-screen-ipad-landscape-retina.png"   media="(device-width: 768px)	and (orientation: landscape)	and (-webkit-device-pixel-ratio: 2)"/>
    <link href="styles/style.css"     		rel="stylesheet" type="text/css">
    <link href="styles/framework.css" 		rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" 	 rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" 		rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css"		 rel="stylesheet" type="text/css">
    <link href="styles/colorbox.css"		 rel="stylesheet" type="text/css">
    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/owl.carousel.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.swipebox.js"></script>
    <script type="text/javascript" src="scripts/jquery.colorbox-min.js"></script>
    <script type="text/javascript" src="scripts/snap.js"></script>
    <script type="text/javascript" src="scripts/contact.js"></script>
    <script type="text/javascript" src="scripts/framework.js"></script>
    <script type="text/javascript" src="scripts/framework.launcher.js"></script>
    <script type="text/javascript" src="scripts/socket.io.js"></script>
    <title>监控</title>
</head>
<body>
   <div class="content">
    <div class="header">
        <a href="#" class="homepage-logo">
            <img src="images/misc/logo.png" alt="img">
        </a>
        <a href="home.html" class="go-home">HOME</a>
        <a href="#" class="go-menu">MENU</a>
        <a href="#" class="go-back">CLOSE</a>
    </div>
    <div class="decoration"></div>
    
    <div class="navigation">
        <div class="corner-deco"></div>
        <div class="navigation-wrapper">
            <div class="navigation">
        <div class="corner-deco"></div>
        <div class="navigation-wrapper">
            <div class="navigation-item">
                <a href="home.html">首页</a>
                <em class="active-menu"></em>
            </div>
            <div class="navigation-item">
                <a href="download.html">离线下载</a>
                <em class="active-menu"></em>
            </div>
            <div class="navigation-item">
                <a href="storage.html">云存储</a>
                <em class="active-menu"></em>
            </div>
            <div class="navigation-item">
                <a href="theatra.html">家庭影院</a>
                <em class="active-menu"></em>
            </div>
            <div class="navigation-item">
                <a href="contact.html">音乐</a>
                <em class="active-menu"></em>
            </div>
            <div class="navigation-item">
                <a href="jquery.html">设定</a>
                <em class="activen-menu"></em>
            </div>
        </div>
    </div>
        </div>
    </div>
</div>

<div class="content">
	<div class="decoration"></div>
    <div class="container">
    	<h3>监控页面</h3>
        <div class="display">
            <canvas id="display" width="640" height="480">你的浏览器暂不支持Canvas,请更换浏览器后再试</canvas>
        </div>
    </div>
      
    <div class="decoration"></div>         
    
    <div class="footer">
        <div class="clear"></div>
        <p class="copyright">
        	COPYRIGHT 2015.<br>
            ALL RIGHTS RESERVED
        </p>
        
    </div> 
</div>

<div class="bottom-deco"></div>
<script type="text/javascript">
    $(function(){    

        displayWidth = null;

        //初始化屏幕宽度
        var windowWidth = screen.width;
        var image = new Image();
        var canvas = document.getElementById("display");
        if(!isPC())
            //如果不为pc端,调制canvas宽度
            canvas.width = windowWidth*0.9;

        var ctx = canvas.getContext("2d");
        //建立websocket连接
        var socket=io.connect('127.0.0.1:3000')
        //设置缩放比例
        var scale = 3/4
        //接收udp信息,转发给客户端
        socket.on("message",function(msg){
            image.src = "data:image/jpg;base64,"+msg.frame;
            image.onload = function(){
                if(displayWidth == null){
                    //初始化
                    displayWidth = windowWidth < image.width?windowWidth*0.9:image.width;
                }

                ctx.drawImage(image,0,0,displayWidth,displayWidth * scale);
            }
        });
        function isPC() {
            //判断客户端是否为PC
            var userAgentInfo = navigator.userAgent;
            var Agents = ["Android", "iPhone",
                "SymbianOS", "Windows Phone",
                "iPad", "iPod"];
            var flag = true;
            for (var v = 0; v < Agents.length; v++) {
                if (userAgentInfo.indexOf(Agents[v]) > 0) {
                    flag = false;
                    break;
                }
            }
            return flag;
        }
    })
</script>
</body>
</html>